# =========================================================
# Base44 • Master .env (clean, de-duped, mock-ready)
# End goal: full automation with guardrails
# =========================================================

# ===== Core / runtime =====
TZ=America/Phoenix
PYTHONUNBUFFERED=1
HTTP_TIMEOUT_S=15
LOG_LEVEL=INFO              # DEBUG/INFO/WARNING/ERROR
LOG_JSON=false
LOG_FILE_PER_LOGGER=false

# ===== Paths =====
# Central guard state (guard.py default is .state/guard_state.json)
GUARD_STATE_FILE=./registry/guard_state.json
DECISION_LOG_DIR=./logs/decisions
DECISION_LOG_FORMATS=jsonl,parquet
DECISION_LOG_FLUSH_SEC=2
DECISION_LOG_ROTATE_DAYS=7
DB_PATH=./state/base44.db

# =========================================================
# RELAY (Flask) + Dashboard
# =========================================================
RELAY_HOST=127.0.0.1
RELAY_PORT=5000
RELAY_URL=https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev
RELAY_BASE=http://127.0.0.1:5000
RELAY_TOKEN=vmj6xRxoaWdt7CdbqQa+Wd//LBCfd/XFTyCGba1yptfE=
RELAY_SECRET=0c5aff4b45534bd8bbc6319fc5f4d6083d43eca68d8549e590d72f44ab26737b
RELAY_CORS_ALLOW=http://localhost:3000,https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev
DASHBOARD_RELAY_BASE=https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev
NGROK_AUTHTOKEN=34ntn4NGQUJc5VG9MODKLnYvKe6_6J4CkxFQnGo6cNqgLguYP


# Legacy executor bridge (new code uses RELAY_URL/RELAY_TOKEN)
EXECUTOR_RELAY_BASE=http://127.0.0.1:5000
EXECUTOR_RELAY_TOKEN=vmj6xRxoaWdt7CdbqQa+Wd//LBCfd/XFTyCGba1yptfE=

# =========================================================
# EXCHANGE / BYBIT (real keys left blank; mock handles fills)
# =========================================================
BYBIT_API_KEY=EpLWxg5fP3NaQs6FvN
BYBIT_API_SECRET=3aXTTQPDFVLaW1plfCwMJBxCyp2GHbv2lW9q
BYBIT_BASE_URL=https://api.bybit.com
# Back-compat for older modules:
BYBIT_BASE=https://api.bybit.com
BYBIT_ACCOUNT_TYPE=unified
BYBIT_NETWORK=mainnet

# =========================================================
# CHAOS HARNESS / MOCK EXCHANGE (tools/chaos_harness.py)
# =========================================================
CHAOS_REJECT_RATE=0.01
CHAOS_NETWORK_RATE=0.01
CHAOS_PARTIAL_RATE=0.20
CHAOS_LATENCY_MS=25

# =========================================================
# TELEGRAM NOTIFY (quiet by default; avoids 401 spam)
# =========================================================
TELEGRAM_BOT_TOKEN=8594421731:AAF2DyHne-gf6qtn4G5I75IidctceJ53A2Q
TELEGRAM_CHAT_ID=7776809236
TELEGRAM_CHAT_IDS=
TELEGRAM_THREAD_ID=
TELEGRAM_DEFAULT_PARSE_MODE=
TELEGRAM_DISABLE_PREVIEW=1
TELEGRAM_NOTIFY=0
TELEGRAM_SILENT=1
TELEGRAM_MAX_RETRIES=3
TELEGRAM_BACKOFF_BASE_MS=400
TELEGRAM_RATE_LIMIT_TPS=1.5
TELEGRAM_DEBUG=0

# Optional multi-bot routing (core/notifier_bot.py)
# TG_CONFIG_PATH=cfg/tg_subaccounts.yaml
SUB_UIDS=260417078,302355261,152304954,65986659,65986592,152499802

# =========================================================
# ACCOUNT OWNERSHIP / TAGGING (shared across bots)
# =========================================================
OWNERSHIP_ENFORCED=true
MANAGE_UNTAGGED=false
OWNERSHIP_SUB_UID=260417078
OWNERSHIP_STRATEGY=A2
TP_MANAGED_TAG=B44
ORDER_TAG_PREFIX=B44
SIG_TAG=B44

# =========================================================
# PORTFOLIO GUARD (Breaker layer v2)
# =========================================================
PG_SWEEP_SEC=7
PG_DD_MAX_PCT=0.012
PG_DD_CLEAR_PCT=0.009
PG_GROSS_EXPO_MAX_PCT=0.60
PG_CONC_MAX_PCT=0.35
PG_BREAKER_TTL_SEC=900
PG_REASON_PREFIX=[B44]
GUARD_NOTIFY=true
GUARD_PREFIX=[B44]

# =========================================================
# REGIME / SIGNAL SCOPES
# =========================================================
# Global regime gate (scanner + executor)
REGIME_MIN_ADX=18
REGIME_MIN_ATR_PCT=0.6
REGIME_MAX_ATR_PCT=5.0
TRADING_WINDOWS=05:30-10:00,12:00-15:30
SYMBOL_WHITELIST=BTCUSDT,ETHUSDT,HBARUSDT,PUMPFUNUSDT,FARTCOINUSDT

# Scanner / advisor
SYMBOL_SCAN_LIST=BTCUSDT,ETHUSDT,HBARUSDT,PUMPFUNUSDT,FARTCOINUSDT
SIGNAL_INTERVAL=5
SIGNAL_LOOKBACK=200
BO_LOOKBACK=20
MIN_VOL_Z=1.5
MIN_ADX=20
MIN_ATR_PCT=0.6
MAX_ATR_PCT=5.0
COOLDOWN_MIN=20

# =========================================================
# EXECUTOR (semi-auto breakout-impulse)
# =========================================================
EXEC_ENABLED=true
ENTRY_MODE=LIMIT_PULLBACK        # LIMIT_PULLBACK | LIMIT_BREAK | MARKET
PULLBACK_BPS=40
POST_ONLY=1
LEVERAGE=20
SAFE_MODE=1
DRY_RUN=1                        # flip to 0 when you trust it
EXEC_SYMBOLS=BTCUSDT,ETHUSDT,HBARUSDT
LOOKBACK=200
EXEC_COOLDOWN_SEC=300
OBSERVED_QUEUE=signals/observed.jsonl

# =========================================================
# TP/SL MANAGER (bots/tp_sl_manager.py)
# =========================================================
TPSL_ENABLED=true
TPSL_POLL_SEC=4

TP_RUNGS=5
TP_EQUAL_R_START=0.5
TP_EQUAL_R_STEP=0.5
TP_RUNG_SIZE_PCT=20

TP_POST_ONLY=true
TP_SPREAD_OFFSET_RATIO=0.35
TP_MAX_MAKER_OFFSET_TICKS=5
TP_FALLBACK_OFFSET_TICKS=2

TP_ADOPT_EXISTING=true
TP_CANCEL_NON_B44=false
TP_STARTUP_GRACE_SEC=20
STARTUP_WARMUP_SEC=20

TP_SL_TF=5
TP_SL_LOOKBACK=120
TP_SL_SWING_WIN=20
TP_SL_ATR_MULT_FALLBACK=0.45
TP_SL_ATR_BUFFER=0.08
TP_STOP_TRAIL=false

TP_MAX_ORDERS_PER_SYMBOL=12
TP_SYMBOL_WHITELIST=BTCUSDT,ETHUSDT
TP_DRY_RUN=false

# =========================================================
# OUTCOME WATCHER
# =========================================================
OUTCOME_POLL_SEC=5
OUTCOME_EXEC_LOOKBACK_SEC=900

# =========================================================
# RECONCILER (bots/reconciler.py + bots/reconcile_ladder.py)
# =========================================================
RECON_ENABLED=true
RECON_INTERVAL_SEC=5
RECON_DRY_RUN=false
RECON_SAFE_MODE=true
RECON_TOUCH_MANUAL=false
RECON_TAG_PREFIX=B44
RECON_CANCEL_STRAYS=false

RECON_POLL_SEC=8
RECON_ADOPT_EXISTING=true
RECON_RUNG_COUNT=50
RECON_QTY_MODE=equal                 # equal | linear | frontload
RECON_QTY_MIN_FRACTION=0.004
RECON_POST_ONLY=true
RECON_PRICE_TOL_BPS=6

RECON_GRID_MODE=ATR                  # ATR | FIXED
RECON_ATR_LEN=14
RECON_ATR_MULT=3.0
RECON_FIXED_STEP_BPS=35

RECON_SL_OFFSET_BPS=180
RECON_SL_TRIGGER=MARKPRICE           # or LASTPRICE

RECON_INCLUDE_LONGS=true
RECON_INCLUDE_SHORTS=true
RECON_SYMBOL_WHITELIST=BTCUSDT,ETHUSDT

RECON_CATEGORY=linear
RECON_SETTLE_COIN=USDT
RECON_SUB_UID=

RECON_HEARTBEAT_MIN=10
RECON_ALERT_COOLDOWN_SEC=120

# =========================================================
# PnL Logger / Reporting
# =========================================================
PNL_EQUITY_COIN=USDT
PNL_SUB_UIDS=260417078,152304954,302355261,65986659,65986592,152499802
PNL_SNAPSHOT_HHMM=00:01
PNL_REPORT_HHMM=23:59
PNL_POLL_SEC=1800
PNL_SEND_HOURLY=true
PNL_SEND_DAILY=true
PNL_DAILY_SEND_HOUR=23

# =========================================================
# Approval / Security (optional service)
# =========================================================
APPROVAL_HOST=0.0.0.0
APPROVAL_PORT=5055
APPROVAL_DATA_DIR=.state
PUBLIC_BASE_URL=http://127.0.0.1:5055

APPROVAL_SERVICE_URL=http://127.0.0.1:5055
APPROVAL_SERVICE_HOST=127.0.0.1
APPROVAL_SERVICE_PORT=5055
APPROVAL_SHARED_SECRET=change_this_to_a_long_random_string
APPROVAL_REQUIRE_CLEAR=1
APPROVAL_ACCOUNT_KEY=portfolio
APPROVAL_TIMEOUT_SEC=180

SECURITY_ENABLED=true
SECURITY_SECRET=change_me_to_64_random_chars
ALWAYS_ACCESS_SUB_UID=260417078

# Approver routing (choose telegram or email; don’t duplicate tokens above)
APPROVER_PROVIDER=telegram         # telegram | email
# If using telegram approver, reuse TELEGRAM_BOT_TOKEN / CHAT_ID above.
SMTP_HOST=smtp.mailprovider.com
SMTP_PORT=587
SMTP_USER=me@example.com
SMTP_PASS=your_app_password
SMTP_FROM=Base44 <no-reply@yourdomain.tld>
APPROVER_EMAIL_TO=trusted-friend@example.com

# =========================================================
# Network proxy (optional)
# =========================================================
PROXY_ENABLE=false
HTTP_PROXY=
HTTPS_PROXY=

# =========================================================
# Legacy toggles kept for backward compat (don’t touch unless needed)
# =========================================================
OBSERVE_ONLY=true
OBSERVE_TEST_SIGNAL=true
OBSERVE_APPEND=false
RISK_POLL_SEC=30
RISK_MAX_DD_PCT=3.0
RISK_AUTOFIX=false
RISK_AUTOFIX_DRY_RUN=true
RISK_CLOSE_ON_VIOLATION=false
RISK_NOTIFY_EVERY_MIN=10
ENFORCE_WHITELIST=false
SIG_ENABLED=true
SIG_DRY_RUN=true
SIG_SYMBOLS=BTCUSDT,ETHUSDT
SIG_TIMEFRAMES=5,15
SIG_BIAS_TF=60
SIG_HEARTBEAT_MIN=10
SIG_MIN_ADX_BIAS=18
SIG_MIN_ATR_PCT=0.15
SIG_MIN_VOL_Z=0.5
SIG_MAKER_ONLY=true
SIG_SPREAD_MAX_BPS=8
SIG_STOP_DIST_MODE=auto
SIG_STOP_ATR_MULT=3.0
SIG_STOP_PCT=1.2
SIGNAL_OUT_DIR=signals
SIGNAL_QUEUE_FILE=observed.jsonl
