# =========================================================
# Base44 • Master .env (organized, complete)
# End goal: full automation with guardrails
# =========================================================

# ===== Core time/locale =====
TZ=America/Phoenix

# ===== Relay (Flask) =====
RELAY_HOST=127.0.0.1
RELAY_PORT=5000
LOG_LEVEL=INFO

# External/public URL for bots to reach the relay (ngrok etc.)
RELAY_URL=https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev
# Local base, if some tools call the relay directly on localhost
RELAY_BASE=http://127.0.0.1:5000

# ===== Relay security / CORS =====
RELAY_TOKEN=vmj6xRxoaWdt7CdbqQa+Wd//LBCfd/XFTyCGba1yptfE=
RELAY_SECRET=0c5aff4b45534bd8bbc6319fc5f4d6083d43eca68d8549e590d72f44ab26737b
RELAY_CORS_ALLOW=http://localhost:3000,https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev

# ===== Dashboard (read-only) =====
DASHBOARD_RELAY_BASE=https://YOUR-NGROK-SUBDOMAIN.ngrok-free.dev

# ===== Executor-to-relay (legacy; new code uses RELAY_URL/RELAY_TOKEN) =====
EXECUTOR_RELAY_BASE=http://127.0.0.1:5000
EXECUTOR_RELAY_TOKEN=vmj6xRxoaWdt7CdbqQa+Wd//LBCfd/XFTyCGba1yptfE=

# ===== Bybit credentials / environment =====
BYBIT_API_KEY=EpLWxg5fP3NaQs6FvN
BYBIT_API_SECRET=3aXTTQPDFVLaW1plfCwMJBxCyp2GHbv2lW9q
BYBIT_BASE=https://api.bybit.com
BYBIT_ACCOUNT_TYPE=unified
BYBIT_NETWORK=mainnet

# ===== Ngrok (or tunnel) =====
NGROK_AUTHTOKEN=34ntn4NGQUJc5VG9MODKLnYvKe6_6J4CkxFQnGo6cNqgLguYP
# NGROK_DOMAIN=

# ===== Telegram notifications =====
TELEGRAM_BOT_TOKEN=8594421731:AAF2DyHne-gf6qtn4G5I75IidctceJ53A2Q
TELEGRAM_CHAT_ID=7776809236
# Optional broadcast list if you support multiple recipients
TELEGRAM_CHAT_IDS=
SUB_UIDS=260417078,302355261,152304954,65986659,65986592,152499802

# =========================================================
# AUTOMATION LAYER (gate, signals, guard, executor)
# =========================================================

# ----- Regime / session gate (shared) -----
REGIME_MIN_ADX=18
REGIME_MIN_ATR_PCT=0.6
REGIME_MAX_ATR_PCT=5.0
# Trading windows (24h local), comma-separated
TRADING_WINDOWS=05:30-10:00,12:00-15:30
# Whitelist symbols; blank = all
SYMBOL_WHITELIST=BTCUSDT,ETHUSDT,HBARUSDT,PUMPFUNUSDT,FARTCOINUSDT

# ----- Signal Advisor (scanner-only) -----
SYMBOL_SCAN_LIST=BTCUSDT,ETHUSDT,HBARUSDT,PUMPFUNUSDT,FARTCOINUSDT
SIGNAL_INTERVAL=5
SIGNAL_LOOKBACK=200
BO_LOOKBACK=20
MIN_VOL_Z=1.5
MIN_ADX=20
MIN_ATR_PCT=0.6
MAX_ATR_PCT=5.0
COOLDOWN_MIN=20

# ----- Portfolio Guard (Risk Daemon Lite) -----
BASE_ASSET=USDT
# Per-trade risk as PERCENT of equity (e.g., 0.20 = 0.20%)
RISK_PCT=0.20
# Halt for the day if drawdown from session start exceeds this percent
DAILY_LOSS_CAP_PCT=1.0
# Concurrency & concentration
MAX_CONCURRENT=2
MAX_SYMBOL_TRADES=1
GUARD_STATE_FILE=./registry/guard_state.json

# ----- Semi-auto Executor (breakout-impulse) -----
# Entry behavior
ENTRY_MODE=LIMIT_PULLBACK        # LIMIT_PULLBACK | LIMIT_BREAK | MARKET
PULLBACK_BPS=40                  # 0.40% below break
POST_ONLY=1                      # maker-only when limit
LEVERAGE=20
SAFE_MODE=1                      # place SL; forbid flatten ops
DRY_RUN=1                        # simulate until proven safe

# If you want different scan symbols for the executor than the advisor:
EXEC_SYMBOLS=BTCUSDT,ETHUSDT,HBARUSDT
# Re-use signal thresholds by default; override below if needed:
LOOKBACK=200
MIN_VOL_Z=1.5
# MIN_ADX / MIN_ATR_PCT / MAX_ATR_PCT inherit from above unless overridden
# Execution throttle
EXEC_COOLDOWN_SEC=300

# =========================================================
# EXISTING BOTS (TP/SL Manager, PnL Logger, etc.)
# =========================================================

# ----- TP/SL Manager -----
TP_ADOPT_EXISTING=true
TP_CANCEL_NON_B44=false
TP_DRY_RUN=false
TP_STARTUP_GRACE_SEC=20
TP_MANAGED_TAG=B44
TP_WS_DISABLE=true
TP_PERIODIC_SWEEP_SEC=6
TP_SYMBOL_WHITELIST=
# Optional orderLinkId prefix you “own”
# TP_TAG_PREFIX=B44

# ----- PnL Logger / Rollup -----
PNL_EQUITY_COIN=USDT
PNL_SUB_UIDS=260417078,152304954,302355261,65986659,65986592,152499802
PNL_SNAPSHOT_HHMM=00:01
PNL_REPORT_HHMM=23:59
PNL_POLL_SEC=1800
PNL_SEND_HOURLY=true
PNL_SEND_DAILY=true
PNL_DAILY_SEND_HOUR=23

# ----- Coach / misc -----
MAIN_SUB_UID=
VEHICLE_SUB_UID=
START_DATE=2025-11-01
COACH_POLL_SEC=60

# ----- Proxy safety (off by default) -----
PROXY_ENABLE=false
HTTP_PROXY=
HTTPS_PROXY=

# =========================================================
# LEGACY / OBSOLETE KEYS (kept for backward compat)
# Toggle these off or delete once all code paths migrate.
# =========================================================
# Observe-only signal engine (legacy)
OBSERVE_ONLY=true
OBSERVE_TEST_SIGNAL=true
OBSERVE_APPEND=false

# Old risk daemon knobs (superseded by Portfolio Guard)
RISK_POLL_SEC=30
RISK_MAX_DD_PCT=3.0
RISK_AUTOFIX=false
RISK_AUTOFIX_DRY_RUN=true
RISK_CLOSE_ON_VIOLATION=false
RISK_NOTIFY_EVERY_MIN=10
ENFORCE_WHITELIST=false

# Legacy symbol gates for old modules
SIG_ENABLED=true
SIG_TIMEFRAMES=5,15
SIG_BIAS_TF=60
SIG_SYMBOLS=BTCUSDT,ETHUSDT
SIG_POLL_SEC=30
SIG_ADX_LEN=14
SIG_ATR_LEN=14
SIG_VOL_Z_WIN=60
SIG_MIN_ADX=18
SIG_MIN_ATR_PCT=0.25
SIG_NOTIFY_COOLDOWN_SEC=300
SIG_SEND_CHART_LINKS=false
SIG_DRY_RUN=true
SIG_HEARTBEAT_MIN=10

# Old executor toggles (prefer new DRY_RUN/ENTRY_MODE/etc.)
LIVE=false
EXEC_ENABLED=true
EXEC_DRY_RUN=true
EXEC_TIMEFRAMES=5,15
EXEC_BIAS_TF=60
EXEC_POLL_SEC=20
EXEC_MIN_ADX=18
EXEC_MIN_ATR_PCT=0.25
EXEC_VOLZ_MIN=0.8
EXEC_POSTONLY_TICKS=2
EXEC_MAX_LEVERAGE=50
EXEC_RISK_PCT=0.15
EXEC_EQUITY_COIN=USDT
EXEC_TRADING_START=00:00
EXEC_TRADING_END=23:59
EXEC_ALLOW_SHORTS=true

# ----- Reconciler -----
RECON_ENABLED=true
RECON_DRY_RUN=true
RECON_SAFE_MODE=true
RECON_POLL_SEC=8
RECON_TAG_PREFIX=B44
RECON_ADOPT_EXISTING=true
RECON_CANCEL_STRAYS=false

RECON_RUNG_COUNT=50
RECON_QTY_MODE=equal           # equal | linear | frontload
RECON_QTY_MIN_FRACTION=0.004
RECON_POST_ONLY=true
RECON_PRICE_TOL_BPS=6

RECON_GRID_MODE=ATR            # ATR | FIXED
RECON_ATR_LEN=14
RECON_ATR_MULT=3.0
RECON_FIXED_STEP_BPS=35

RECON_SL_OFFSET_BPS=180
RECON_SL_TRIGGER=MARKPRICE     # or LASTPRICE

# Optional scoping
RECON_INCLUDE_LONGS=true
RECON_INCLUDE_SHORTS=true
RECON_SYMBOL_WHITELIST=

# ----- Decision logging -----
DECISION_LOG_DIR=./logs/decisions
DECISION_LOG_FORMATS=jsonl,parquet     # supports jsonl, parquet (needs pyarrow or fastparquet)
DECISION_LOG_FLUSH_SEC=2               # batch flush frequency
DECISION_LOG_ROTATE_DAYS=7             # keep last N days (jsonl untouched; parquet folder pruned)

# ----- Account policy -----
ACCOUNT_POLICY_FILE=./registry/account_policy.json


# Multi-account + tagging
EXEC_ACCOUNT_UID=MAIN             # or 260417078 etc.
ORDER_TAG_PREFIX=B44


# --- Signal Engine emit options ---
SIG_TAG=B44
SIG_MAKER_ONLY=true
SIG_SPREAD_MAX_BPS=8
SIG_STOP_DIST_MODE=auto     # auto | atr_mult | pct
SIG_STOP_ATR_MULT=3.0
SIG_STOP_PCT=1.2

SIGNAL_OUT_DIR=signals
SIGNAL_QUEUE_FILE=observed.jsonl


# Timezone
TZ=Europe/London

# Bybit
BYBIT_API_KEY=YOUR_KEY
BYBIT_API_SECRET=YOUR_SECRET
BYBIT_ENV=mainnet

# Optional relay
RELAY_URL=https://your-ngrok-subdomain.ngrok-free.dev
RELAY_TOKEN=your-long-random-token

# Telegram (optional but recommended)
TELEGRAM_BOT_TOKEN=123456:abcdef-your-bot-token
TELEGRAM_CHAT_ID=7776809236

# Signal Engine
SIG_ENABLED=true
SIG_DRY_RUN=true
SIG_SYMBOLS=BTCUSDT,ETHUSDT
SIG_TIMEFRAMES=5,15
SIG_BIAS_TF=60
SIG_HEARTBEAT_MIN=10
SIG_MIN_ADX_BIAS=18
SIG_MIN_ATR_PCT=0.15
SIG_MIN_VOL_Z=0.5

# TP/SL Manager
TPSL_ENABLED=false
TPSL_POLL_S=10
TPSL_TARGET_RUNGS=50

# Network
HTTP_TIMEOUT_S=15
# HTTPS_PROXY=http://127.0.0.1:7890

LOG_LEVEL=INFO              # DEBUG/INFO/WARNING/ERROR
LOG_JSON=false              # true for JSON logs
LOG_FILE_PER_LOGGER=false   # true to split files per logger name
